<!DOCTYPE html>
<html lang='zh-CN'>
<head>
    <meta charset='UTF-8' />
    <meta name='viewport' content='width=device-width, initial-scale=1.0' />
    <title>图书详情 - 雀语图书馆</title>
    <script src='https://cdn.tailwindcss.com'></script>
    <link href='https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css' rel='stylesheet' />
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#34D399',
                        // 清新绿色主色调
                        secondary: '#10B981',
                        // 深一点的绿色
                        accent: '#059669',
                        // 强调色
                        light: '#ECFDF5',
                        // 浅色背景
                        dark: '#1E293B' // 深色文字
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-up': 'slideUp 0.4s ease-out forwards',
                        'scale-in': 'scaleIn 0.3s ease-out forwards'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': {
                                opacity: '0'
                            },
                            '100%': {
                                opacity: '1'
                            }
                        },
                        slideUp: {
                            '0%': {
                                transform: 'translateY(10px)',
                                opacity: '0'
                            },
                            '100%': {
                                transform: 'translateY(0)',
                                opacity: '1'
                            }
                        },
                        scaleIn: {
                            '0%': {
                                transform: 'scale(0.98)',
                                opacity: '0'
                            },
                            '100%': {
                                transform: 'scale(1)',
                                opacity: '1'
                            }
                        }
                    }
                }
            }
        };
    </script>
    <style type='text/tailwindcss'>
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .bg-gradient-green {
                background: linear-gradient(135deg, #34D399 0%, #10B981 100%);
            }
            .card-shadow {
                box-shadow: 0 4px 6px -1px rgba(52, 211, 153, 0.1), 0 2px 4px -1px rgba(52, 211, 153, 0.06);
            }
            .btn-hover {
                @apply hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-300;
            }
            .section-animate {
                opacity: 0;
                animation: fadeIn 0.5s ease-out forwards;
            }
            .section-delay-1 {
                animation-delay: 0.1s;
            }
            .section-delay-2 {
                animation-delay: 0.2s;
            }
            .section-delay-3 {
                animation-delay: 0.3s;
            }
            .section-delay-4 {
                animation-delay: 0.4s;
            }
        }
    </style>
</head>
<body class='bg-light min-h-screen pb-20'>
    <!-- 顶部导航栏 -->
    <header class='sticky top-0 z-30 bg-white shadow-sm py-3 px-4 flex items-center'>
        <button id='backBtn' class='w-10 h-10 flex items-center justify-center text-gray-700 rounded-full hover:bg-gray-100 transition-colors'>
            <i class='fas fa-arrow-left'></i>
        </button>
        <h1 class='text-lg font-medium text-center flex-1'>图书详情</h1>
        <div class='w-10'></div> <!-- 占位，保持标题居中 -->
    </header>

    <!-- 主内容区 -->
    <main class='px-4 py-5'>
        <!-- 图书基本信息 -->
        <div class='flex space-x-4 mb-6 section-animate'>
            <div class='w-32 h-48 bg-gray-100 rounded-lg overflow-hidden shadow-md'>
                <img id='bookCover' src='https://picsum.photos/id/24/300/450' alt='图书封面' class='w-full h-full object-cover'>
            </div>
            <div class='flex-1 flex flex-col justify-between'>
                <div>
                    <h2 id='bookTitle' class='text-xl font-bold mb-1'>活着</h2>
                    <p id='bookAuthor' class='text-gray-600 mb-2'>余华</p>
                    <div class='flex items-center mb-2'>
                        <span id='bookRating' class='text-primary font-medium text-sm mr-4'>评分 9.4</span>
                        <span id='bookStock' class='text-gray-500 text-sm'>馆藏 23</span>
                    </div>
                    <div class='flex space-x-2'>
                        <span class='px-2 py-1 bg-primary/10 text-primary text-xs rounded-full'>文学</span>
                        <span class='px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full'>当代小说</span>
                    </div>
                </div>
                <div class='flex space-x-3'>
                    <button id='borrowBtn' class='flex-1 py-2.5 bg-primary text-white rounded-lg font-medium text-center btn-hover'>
                        立即借阅
                    </button>
                    <button id='favoriteBtn' class='w-12 h-12 flex items-center justify-center bg-gray-100 rounded-lg text-gray-700 btn-hover'>
                        <i class='far fa-heart'></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- 图书信息卡片 -->
        <div class='bg-white rounded-xl p-4 mb-4 shadow-sm section-animate section-delay-1'>
            <h3 class='text-base font-medium mb-3 pb-2 border-b border-gray-100'>图书信息</h3>
            <div class='space-y-2 text-sm'>
                <div class='flex justify-between'>
                    <span class='text-gray-500'>ISBN</span>
                    <span id='bookIsbn' class='text-gray-800'>9787544243088</span>
                </div>
                <div class='flex justify-between'>
                    <span class='text-gray-500'>出版社</span>
                    <span id='bookPublisher' class='text-gray-800'>南海出版公司</span>
                </div>
                <div class='flex justify-between'>
                    <span class='text-gray-500'>出版时间</span>
                    <span id='bookPublishDate' class='text-gray-800'>2011-05</span>
                </div>
                <div class='flex justify-between'>
                    <span class='text-gray-500'>页数</span>
                    <span id='bookPages' class='text-gray-800'>191</span>
                </div>
                <div class='flex justify-between'>
                    <span class='text-gray-500'>装帧</span>
                    <span id='bookBinding' class='text-gray-800'>平装</span>
                </div>
                <div class='flex justify-between'>
                    <span class='text-gray-500'>语言</span>
                    <span id='bookLanguage' class='text-gray-800'>简体中文</span>
                </div>
            </div>
        </div>

        <!-- 内容简介 -->
        <div class='bg-white rounded-xl p-4 mb-4 shadow-sm section-animate section-delay-2'>
            <h3 class='text-base font-medium mb-3 pb-2 border-b border-gray-100'>内容简介</h3>
            <p id='bookDescription' class='text-gray-700 text-sm leading-relaxed'>
                《活着》是作家余华的代表作之一，讲述了在大时代背景下，福贵一生的坎坷命运。小说以普通人的平凡生活为蓝本，通过福贵一生的经历，反映了从解放前到改革开放后的中国社会变迁。福贵本是个阔少爷，可他嗜赌如命，终于赌光了家业，一贫如洗。他的父亲被他活活气死，母亲则在穷困中患了重病，福贵前去求药，却在途中被国民党抓去当壮丁，后被解放军俘虏，回到家中才知道母亲早已去世，妻子家珍含辛茹苦地养大两个孩子。此后更加悲惨的命运一次又一次降临到福贵身上，他的妻子、儿女和孙子相继死去，最后只剩福贵和一头老牛相依为命，但老人依旧活着，仿佛比往日更加洒脱与坚强。
            </p>
        </div>

        <!-- 作者简介 -->
        <div class='bg-white rounded-xl p-4 mb-4 shadow-sm section-animate section-delay-3'>
            <h3 class='text-base font-medium mb-3 pb-2 border-b border-gray-100'>作者简介</h3>
            <p id='authorDescription' class='text-gray-700 text-sm leading-relaxed'>
                余华，1960年4月3日生于浙江杭州，当代作家。1984年开始发表小说，《活着》和《许三观卖血记》同时入选百位批评家和文学编辑评选的九十年代最具有影响的十部作品。1998年获意大利格林扎纳·卡佛文学奖。2005年获得中华图书特殊贡献奖。
            </p>
        </div>

        <!-- 读者评价 -->
        <div class='bg-white rounded-xl p-4 mb-4 shadow-sm section-animate section-delay-4'>
            <div class='flex justify-between items-center mb-3 pb-2 border-b border-gray-100'>
                <h3 class='text-base font-medium'>读者评价</h3>
                <span class='text-primary text-sm'>查看全部</span>
            </div>
            <div class='space-y-4'>
                <!-- 评价1 -->
                <div class='flex space-x-3'>
                    <div class='w-8 h-8 rounded-full bg-gray-200 flex-shrink-0'></div>
                    <div class='flex-1'>
                        <div class='flex justify-between items-start mb-1'>
                            <span class='text-sm font-medium'>李小明</span>
                            <span class='text-xs text-gray-400'>2023-06-15</span>
                        </div>
                        <div class='flex items-center mb-1'>
                            <i class='fas fa-star text-yellow-400 text-xs'></i>
                            <i class='fas fa-star text-yellow-400 text-xs'></i>
                            <i class='fas fa-star text-yellow-400 text-xs'></i>
                            <i class='fas fa-star text-yellow-400 text-xs'></i>
                            <i class='fas fa-star text-yellow-400 text-xs'></i>
                        </div>
                        <p class='text-sm text-gray-700'>非常感人的一本书，通过福贵的一生，让我感受到了生命的顽强和生活的意义。余华的文字朴实无华，但却有着直击人心的力量。</p>
                    </div>
                </div>
                <!-- 评价2 -->
                <div class='flex space-x-3'>
                    <div class='w-8 h-8 rounded-full bg-gray-200 flex-shrink-0'></div>
                    <div class='flex-1'>
                        <div class='flex justify-between items-start mb-1'>
                            <span class='text-sm font-medium'>张小华</span>
                            <span class='text-xs text-gray-400'>2023-05-20</span>
                        </div>
                        <div class='flex items-center mb-1'>
                            <i class='fas fa-star text-yellow-400 text-xs'></i>
                            <i class='fas fa-star text-yellow-400 text-xs'></i>
                            <i class='fas fa-star text-yellow-400 text-xs'></i>
                            <i class='fas fa-star text-yellow-400 text-xs'></i>
                            <i class='far fa-star text-yellow-400 text-xs'></i>
                        </div>
                        <p class='text-sm text-gray-700'>这是我第二次读《活着》了，每次读都有不同的感受。余华用最朴素的语言讲述了一个最沉重的故事，让人在悲伤中看到希望。</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 引入存储管理模块 -->
    <script src='utils/storage.js'></script>
    <!-- 加载通用底部导航栏 -->
    <script src='components/load-components.js'></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 获取URL中的图书ID参数
            function getBookIdFromUrl() {
                const urlParams = new URLSearchParams(window.location.search);
                const id = urlParams.get('id');
                return id ? parseInt(id) : 1; // 默认返回ID为1的图书
            }

            // 模拟图书数据
            const mockBooks = [
                {
                    id: 1,
                    title: '活着',
                    author: '余华',
                    cover: 'https://picsum.photos/id/24/300/450',
                    rating: 9.4,
                    stock: 23,
                    categories: ['文学', '当代小说'],
                    isbn: '9787544243088',
                    publisher: '南海出版公司',
                    publishDate: '2011-05',
                    pages: 191,
                    binding: '平装',
                    language: '简体中文',
                    description: '《活着》是作家余华的代表作之一，讲述了在大时代背景下，福贵一生的坎坷命运。小说以普通人的平凡生活为蓝本，通过福贵一生的经历，反映了从解放前到改革开放后的中国社会变迁。福贵本是个阔少爷，可他嗜赌如命，终于赌光了家业，一贫如洗。他的父亲被他活活气死，母亲则在穷困中患了重病，福贵前去求药，却在途中被国民党抓去当壮丁，后被解放军俘虏，回到家中才知道母亲早已去世，妻子家珍含辛茹苦地养大两个孩子。此后更加悲惨的命运一次又一次降临到福贵身上，他的妻子、儿女和孙子相继死去，最后只剩福贵和一头老牛相依为命，但老人依旧活着，仿佛比往日更加洒脱与坚强。',
                    authorDescription: '余华，1960年4月3日生于浙江杭州，当代作家。1984年开始发表小说，《活着》和《许三观卖血记》同时入选百位批评家和文学编辑评选的九十年代最具有影响的十部作品。1998年获意大利格林扎纳·卡佛文学奖。2005年获得中华图书特殊贡献奖。'
                },
                {
                    id: 2,
                    title: '三体',
                    author: '刘慈欣',
                    cover: 'https://picsum.photos/id/20/300/450',
                    rating: 9.2,
                    stock: 18,
                    categories: ['科幻', '硬科幻'],
                    isbn: '9787536692930',
                    publisher: '重庆出版社',
                    publishDate: '2008-01',
                    pages: 302,
                    binding: '精装',
                    language: '简体中文',
                    description: '文化大革命如火如荼地进行，天文学家叶文洁在运动中遭受迫害，被送到青海支援建设。她在荒无人烟的雷达站接收到了来自宇宙深处的信息。在这个信息中，三体文明对地球文明表现出了浓厚的兴趣。叶文洁帮助三体文明制定了入侵地球的计划，同时也成为了ETO(地球三体组织)的精神领袖。四百年后，三体文明的舰队出发前往地球，人类的末日即将来临。',
                    authorDescription: '刘慈欣，1963年6月出生于北京，山西阳泉人，高级工程师，科幻作家，中国作家协会会员、第九届全委会委员，中国科普作家协会会员，山西省作家协会副主席。'
                },
                {
                    id: 3,
                    title: '解忧杂货店',
                    author: '东野圭吾',
                    cover: 'https://picsum.photos/id/22/300/450',
                    rating: 8.9,
                    stock: 25,
                    categories: ['文学', '小说'],
                    isbn: '9787544270878',
                    publisher: '南海出版公司',
                    publishDate: '2014-05',
                    pages: 291,
                    binding: '精装',
                    language: '简体中文',
                    description: '僻静的街道旁有一家特别的杂货店，只要写下烦恼投进店前门卷帘门的投信口，第二天就会在店后的牛奶箱里得到回答。因男友失业而面临经济困境的女人、为音乐梦想离家漂泊的男人、面临家庭巨变的少年，他们的烦恼通过信件传递到解忧杂货店，而杂货店的主人浪矢爷爷总是认真回答每一个问题。',
                    authorDescription: '东野圭吾，日本推理小说作家。1958年2月4日出生于日本大阪。毕业于大阪府立大学电气工学专业，之后在汽车零件供应商日本电装担任生产技术工程师，并进行推理小说的创作。'
                }
            ];

            // 根据ID获取图书数据
            function getBookById(id) {
                return mockBooks.find(book => book.id === id) || mockBooks[0];
            }

            // 渲染图书详情
            function renderBookDetails(book) {
                document.getElementById('bookCover').src = book.cover;
                document.getElementById('bookTitle').textContent = book.title;
                document.getElementById('bookAuthor').textContent = book.author;
                document.getElementById('bookRating').textContent = `评分 ${book.rating}`;
                document.getElementById('bookStock').textContent = `馆藏 ${book.stock}`;
                document.getElementById('bookIsbn').textContent = book.isbn;
                document.getElementById('bookPublisher').textContent = book.publisher;
                document.getElementById('bookPublishDate').textContent = book.publishDate;
                document.getElementById('bookPages').textContent = book.pages;
                document.getElementById('bookBinding').textContent = book.binding;
                document.getElementById('bookLanguage').textContent = book.language;
                document.getElementById('bookDescription').textContent = book.description;
                document.getElementById('authorDescription').textContent = book.authorDescription;
            }

            // 初始化页面
            const bookId = getBookIdFromUrl();
            const currentBook = getBookById(bookId);
            renderBookDetails(currentBook);

            // 返回按钮事件
            document.getElementById('backBtn').addEventListener('click', function() {
                window.history.back();
            });

            // 收藏按钮事件
            let isFavorite = false;
            document.getElementById('favoriteBtn').addEventListener('click', function() {
                isFavorite = !isFavorite;
                const icon = this.querySelector('i');
                if (isFavorite) {
                    icon.classList.remove('far');
                    icon.classList.add('fas', 'text-red-500');
                    showToast('已添加到收藏');
                } else {
                    icon.classList.remove('fas', 'text-red-500');
                    icon.classList.add('far');
                    showToast('已取消收藏');
                }
            });

            // 借阅按钮事件
            document.getElementById('borrowBtn').addEventListener('click', function() {
                // 检查用户是否登录
                if (!StorageManager.isLoggedIn()) {
                    showToast('请先登录', 'error');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 1500);
                    return;
                }

                // 检查图书是否已被当前用户借阅
                if (StorageManager.isBookBorrowedByUser(bookId)) {
                    showToast('您已借阅过这本书', 'info');
                    return;
                }

                // 添加借阅记录
                if (StorageManager.addBorrowRecord({
                    id: currentBook.id,
                    title: currentBook.title,
                    author: currentBook.author,
                    cover: currentBook.cover
                })) {
                    showToast('借阅成功！');
                    // 更新借阅按钮状态
                    this.textContent = '已借阅';
                    this.classList.remove('bg-primary');
                    this.classList.add('bg-gray-400');
                    this.disabled = true;
                } else {
                    showToast('借阅失败，请稍后重试', 'error');
                }
            });

            // 检查图书借阅状态并更新按钮
            function checkAndUpdateBorrowButton() {
                const borrowBtn = document.getElementById('borrowBtn');
                
                if (StorageManager.isLoggedIn()) {
                    if (StorageManager.isBookBorrowedByUser(bookId)) {
                        borrowBtn.textContent = '已借阅';
                        borrowBtn.classList.remove('bg-primary');
                        borrowBtn.classList.add('bg-gray-400');
                        borrowBtn.disabled = true;
                    }
                }
            }

            // Toast提示函数
            function showToast(message, type = 'success') {
                // 简单的Toast实现
                const toast = document.createElement('div');
                toast.className = `fixed top-20 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded-md text-white ${type === 'error' ? 'bg-red-500' : type === 'info' ? 'bg-blue-500' : 'bg-primary'} transition-opacity duration-300 z-50`;
                toast.textContent = message;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.opacity = '0';
                    setTimeout(() => {
                        document.body.removeChild(toast);
                    }, 300);
                }, 2000);
            }

            // 检查借阅状态
            checkAndUpdateBorrowButton();

            // 显示动画元素
            setTimeout(() => {
                document.querySelectorAll('.section-animate').forEach(el => {
                    el.style.opacity = '1';
                });
            }, 100);
        });
    </script>
</body>
</html>
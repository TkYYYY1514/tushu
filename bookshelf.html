<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„ä¹¦æ¶ - ç§»åŠ¨å›¾ä¹¦é¦†</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#34D399',
                        secondary: '#10B981',
                        accent: '#059669',
                        light: '#ECFDF5',
                        dark: '#1E293B'
                    }
                }
            }
        };
    </script>
    <style type='text/tailwindcss'>
        @layer utilities {
            .tab-active {
                @apply bg-primary/10 text-primary border-primary;
            }
            .tab-inactive {
                @apply bg-gray-100 text-gray-600 border-transparent;
            }
        }
    </style>
</head>
<body class="bg-light min-h-screen pb-20">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="bg-white shadow-sm sticky top-0 z-40">
        <div class="px-4 py-3">
            <h1 class="text-xl font-semibold text-gray-800">æˆ‘çš„ä¹¦æ¶</h1>
        </div>
    </header>

    <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
    <div class="bg-white border-b">
        <div class="flex px-4">
            <button class="tab-btn flex-1 py-3 text-center border-b-2 font-medium transition-all" 
                    data-tab="borrowed" onclick="switchTab('borrowed')">
                <i class="fas fa-book-open mr-2"></i>å·²å€Ÿé˜…
            </button>
            <button class="tab-btn flex-1 py-3 text-center border-b-2 font-medium transition-all" 
                    data-tab="favorites" onclick="switchTab('favorites')">
                <i class="fas fa-heart mr-2"></i>æ”¶è—
            </button>
            <button class="tab-btn flex-1 py-3 text-center border-b-2 font-medium transition-all" 
                    data-tab="return" onclick="switchTab('return')">
                <i class="fas fa-undo mr-2"></i>å¾…å½’è¿˜
            </button>
        </div>
    </div>

    <!-- å†…å®¹åŒºåŸŸ -->
    <main class="p-4">
        <!-- å·²å€Ÿé˜…å›¾ä¹¦ -->
        <div id="borrowed-content" class="tab-content">
            <div class="mb-4">
                <input type="text" id="borrowed-search" placeholder="æœç´¢å·²å€Ÿé˜…å›¾ä¹¦..." 
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
            </div>
            <div id="borrowed-list" class="space-y-3">
                <!-- å€Ÿé˜…å›¾ä¹¦åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- æ”¶è—å›¾ä¹¦ -->
        <div id="favorites-content" class="tab-content hidden">
            <div class="mb-4">
                <input type="text" id="favorites-search" placeholder="æœç´¢æ”¶è—å›¾ä¹¦..." 
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
            </div>
            <div id="favorites-list" class="space-y-3">
                <!-- æ”¶è—å›¾ä¹¦åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- å¾…å½’è¿˜å›¾ä¹¦ -->
        <div id="return-content" class="tab-content hidden">
            <div class="mb-4">
                <input type="text" id="return-search" placeholder="æœç´¢å¾…å½’è¿˜å›¾ä¹¦..." 
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary">
            </div>
            <div id="return-list" class="space-y-3">
                <!-- å¾…å½’è¿˜å›¾ä¹¦åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </main>

    <!-- åº•éƒ¨å¯¼èˆªæ ç»„ä»¶ -->
    <script src='components/load-components.js'></script>

    <!-- å¼•å…¥å­˜å‚¨ç®¡ç†æ¨¡å— -->
    <script src="utils/storage.js"></script>

    <script>
        // å½“å‰æ¿€æ´»çš„æ ‡ç­¾é¡µ
        let currentTab = 'borrowed';

        // è·å–URLå‚æ•°
        function getUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const params = {};
            for (const [key, value] of urlParams) {
                params[key] = value;
            }
            return params;
        }

        // æ ¹æ®URLå‚æ•°åˆå§‹åŒ–æ ‡ç­¾é¡µ
        function initializeTabFromUrl() {
            const params = getUrlParams();
            if (params.tab) {
                const validTabs = ['borrowed', 'favorites', 'return'];
                if (validTabs.includes(params.tab)) {
                    switchTab(params.tab);
                    return;
                }
            }
            // é»˜è®¤æ¿€æ´»ç¬¬ä¸€ä¸ªæ ‡ç­¾é¡µ
            switchTab('borrowed');
        }

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰å†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('tab-inactive');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„å†…å®¹
            document.getElementById(tabName + '-content').classList.remove('hidden');
            
            // è®¾ç½®é€‰ä¸­çš„æ ‡ç­¾ä¸ºæ¿€æ´»çŠ¶æ€
            document.querySelector(`[data-tab="${tabName}"]`).classList.remove('tab-inactive');
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('tab-active');
            
            currentTab = tabName;
            
            // åŠ è½½å¯¹åº”æ ‡ç­¾çš„æ•°æ®
            loadTabData(tabName);
        }

        // åŠ è½½æ ‡ç­¾é¡µæ•°æ®
        function loadTabData(tabName) {
            const listElement = document.getElementById(tabName + '-list');
            
            // æ¨¡æ‹Ÿæ•°æ®åŠ è½½
            listElement.innerHTML = `
                <div class="text-center py-8 text-gray-500">
                    <i class="fas fa-book text-4xl mb-4"></i>
                    <p>æ­£åœ¨åŠ è½½${getTabDisplayName(tabName)}...</p>
                </div>
            `;
            
            // æ¨¡æ‹Ÿå¼‚æ­¥åŠ è½½
            setTimeout(() => {
                const mockData = generateMockData(tabName);
                renderBookList(listElement, mockData, tabName);
            }, 500);
        }

        // è·å–æ ‡ç­¾é¡µæ˜¾ç¤ºåç§°
        function getTabDisplayName(tabName) {
            const names = {
                'borrowed': 'å·²å€Ÿé˜…å›¾ä¹¦',
                'favorites': 'æ”¶è—å›¾ä¹¦',
                'return': 'å¾…å½’è¿˜å›¾ä¹¦'
            };
            return names[tabName] || tabName;
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
        function generateMockData(tabName) {
            const books = [
                {
                    id: 1,
                    title: 'JavaScripté«˜çº§ç¨‹åºè®¾è®¡',
                    author: 'Nicholas C. Zakas',
                    cover: 'ğŸ“˜',
                    borrowDate: '2024-01-15',
                    returnDate: '2024-02-15',
                    status: 'borrowed'
                },
                {
                    id: 2,
                    title: 'æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ',
                    author: 'Randal E. Bryant',
                    cover: 'ğŸ’»',
                    borrowDate: '2024-01-10',
                    returnDate: '2024-02-10',
                    status: 'borrowed'
                },
                {
                    id: 3,
                    title: 'è®¾è®¡æ¨¡å¼',
                    author: 'Erich Gamma',
                    cover: 'ğŸ¨',
                    borrowDate: '2024-01-20',
                    returnDate: '2024-02-20',
                    status: 'return'
                }
            ];
            
            return books.filter(book => book.status === tabName || tabName === 'favorites');
        }

        // æ¸²æŸ“å›¾ä¹¦åˆ—è¡¨
        function renderBookList(container, books, tabName) {
            if (books.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-inbox text-4xl mb-4"></i>
                        <p>æš‚æ— ${getTabDisplayName(tabName)}</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = books.map(book => `
                <div class="bg-white rounded-lg shadow-sm border p-4">
                    <div class="flex items-center">
                        <div class="text-4xl mr-4">${book.cover}</div>
                        <div class="flex-1">
                            <h3 class="font-semibold text-gray-800">${book.title}</h3>
                            <p class="text-sm text-gray-600">${book.author}</p>
                            ${tabName !== 'favorites' ? `
                                <div class="text-xs text-gray-500 mt-1">
                                    <span>å€Ÿé˜…æ—¥æœŸ: ${book.borrowDate}</span>
                                    <span class="mx-2">|</span>
                                    <span>åº”è¿˜æ—¥æœŸ: ${book.returnDate}</span>
                                </div>
                            ` : ''}
                        </div>
                        <button class="ml-2 px-3 py-1 bg-blue-500 text-white rounded text-sm" 
                                onclick="handleBookAction(${book.id}, '${tabName}')">
                            ${getActionButtonText(tabName)}
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // è·å–æ“ä½œæŒ‰é’®æ–‡æœ¬
        function getActionButtonText(tabName) {
            const actions = {
                'borrowed': 'ç»­å€Ÿ',
                'favorites': 'é˜…è¯»',
                'return': 'å½’è¿˜'
            };
            return actions[tabName] || 'æ“ä½œ';
        }

        // å¤„ç†å›¾ä¹¦æ“ä½œ
        function handleBookAction(bookId, actionType) {
            const actions = {
                'borrowed': 'ç»­å€Ÿ',
                'favorites': 'é˜…è¯»',
                'return': 'å½’è¿˜'
            };
            
            alert(`æ‰§è¡Œ${actions[actionType]}æ“ä½œ - å›¾ä¹¦ID: ${bookId}`);
            // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„æ“ä½œé€»è¾‘
        }

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            // æ ¹æ®URLå‚æ•°åˆå§‹åŒ–æ ‡ç­¾é¡µ
            initializeTabFromUrl();
            
            // æ·»åŠ æœç´¢åŠŸèƒ½
            document.querySelectorAll('input[type="text"]').forEach(input => {
                input.addEventListener('input', function() {
                    // æœç´¢åŠŸèƒ½å®ç°
                    console.log('æœç´¢:', this.value);
                });
            });
        });
    </script>
</body>
</html>
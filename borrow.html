<!DOCTYPE html>
<html lang='zh-CN'>
<head>
    <meta charset='UTF-8' />
    <meta name='viewport' content='width=device-width, initial-scale=1.0' />
    <title>图书借阅 - 雀语图书馆</title>
    <script src='https://cdn.tailwindcss.com'></script>
    <link href='https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css' rel='stylesheet' />
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#34D399',
                        secondary: '#10B981',
                        accent: '#059669',
                        light: '#ECFDF5',
                        dark: '#1E293B'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-up': 'slideUp 0.4s ease-out forwards',
                        'scale-in': 'scaleIn 0.3s ease-out forwards',
                        'pulse-soft': 'pulseSoft 2s infinite'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        scaleIn: {
                            '0%': { transform: 'scale(0.98)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' }
                        },
                        pulseSoft: {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '0.8' }
                        }
                    }
                }
            }
        };
    </script>
    <style type='text/tailwindcss'>
        @layer utilities {
            .content-auto { content-visibility: auto; }
            .text-shadow { text-shadow: 0 2px 4px rgba(0,0,0,0.1); }
            .bg-gradient-green { background: linear-gradient(135deg, #34D399 0%, #10B981 100%); }
            .card-shadow { box-shadow: 0 4px 6px -1px rgba(52, 211, 153, 0.1), 0 2px 4px -1px rgba(52, 211, 153, 0.06); }
            .btn-hover { @apply hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-300; }
            .book-item { @apply bg-white rounded-xl p-4 shadow-sm mb-4 transition-all duration-300 hover:shadow-md; }
            .skeleton-loading { @apply animate-pulse bg-gray-200 rounded; }
            .filter-btn-active { @apply bg-primary text-white; }
            .filter-btn-inactive { @apply bg-gray-100 text-gray-600; }
        }
    </style>
</head>
<body class='bg-light min-h-screen pb-20'>
    <!-- 顶部导航栏 -->
    <header class='sticky top-0 z-30 bg-white shadow-sm py-3 px-4 flex items-center transition-all duration-300'>
        <button id='backBtn' class='w-10 h-10 flex items-center justify-center text-gray-700 rounded-full hover:bg-gray-100 transition-all duration-300'>
            <i class='fas fa-arrow-left'></i>
        </button>
        <h1 class='text-lg font-medium text-center flex-1'>图书借阅</h1>
        <div class='w-10'></div> <!-- 占位，保持标题居中 -->
    </header>

    <!-- 主内容区 -->
    <main class='px-4 py-5'>
        <!-- 搜索栏 -->
        <div class='relative mb-6 transform transition-all duration-300 hover:scale-[1.01]'>
            <input 
                type='text' 
                id='searchInput' 
                placeholder='搜索图书名称、作者或ISBN...' 
                class='w-full bg-white rounded-full py-3 px-5 pr-12 text-sm border border-gray-200 focus:outline-none focus:ring-2 focus:ring-primary/30 focus:border-primary transition-all duration-300 shadow-sm'
            >
            <i class='fas fa-search absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 transition-colors duration-300 hover:text-primary'></i>
        </div>

        <!-- 筛选条件卡片 -->
        <div class='bg-white rounded-xl p-4 mb-6 shadow-sm transform transition-all duration-300 hover:shadow-md'>
            <div class='flex justify-between items-center mb-4'>
                <h2 class='text-base font-medium text-dark flex items-center'>
                    <i class='fas fa-filter text-primary mr-2'></i>
                    筛选条件
                </h2>
                <button id='resetFilterBtn' class='text-primary text-sm hover:text-secondary transition-colors duration-300 flex items-center'>
                    <i class='fas fa-redo-alt mr-1 text-xs'></i>
                    重置
                </button>
            </div>
            
            <!-- 分类筛选 -->
            <div class='mb-4'>
                <h3 class='text-sm text-gray-600 mb-2'>分类</h3>
                <div class='flex flex-wrap gap-2'>
                    <button class='category-filter px-3 py-1.5 rounded-full text-xs filter-btn-active transition-all duration-300' data-category='all'>全部</button>
                    <button class='category-filter px-3 py-1.5 rounded-full text-xs filter-btn-inactive transition-all duration-300' data-category='literature'>文学艺术</button>
                    <button class='category-filter px-3 py-1.5 rounded-full text-xs filter-btn-inactive transition-all duration-300' data-category='science'>科学技术</button>
                    <button class='category-filter px-3 py-1.5 rounded-full text-xs filter-btn-inactive transition-all duration-300' data-category='history'>历史地理</button>
                    <button class='category-filter px-3 py-1.5 rounded-full text-xs filter-btn-inactive transition-all duration-300' data-category='biography'>人物传记</button>
                    <button class='category-filter px-3 py-1.5 rounded-full text-xs filter-btn-inactive transition-all duration-300' data-category='sci-fi'>科幻小说</button>
                </div>
            </div>

            <!-- 排序方式 -->
            <div>
                <h3 class='text-sm text-gray-600 mb-2'>排序方式</h3>
                <div class='flex flex-wrap gap-2'>
                    <button class='sort-filter px-3 py-1.5 rounded-full text-xs filter-btn-active transition-all duration-300' data-sort='newest'>最新上架</button>
                    <button class='sort-filter px-3 py-1.5 rounded-full text-xs filter-btn-inactive transition-all duration-300' data-sort='rating'>评分最高</button>
                    <button class='sort-filter px-3 py-1.5 rounded-full text-xs filter-btn-inactive transition-all duration-300' data-sort='stock'>库存最多</button>
                </div>
            </div>
        </div>

        <!-- 借阅规则说明 -->
        <div class='bg-primary/5 rounded-xl p-4 mb-6 border border-primary/20 transform transition-all duration-300 hover:shadow-sm'>
            <h3 class='text-sm font-medium text-primary mb-2 flex items-center'>
                <i class='fas fa-info-circle mr-2'></i>
                借阅规则
            </h3>
            <ul class='text-xs text-gray-600 space-y-1.5'>
                <li class='flex items-start'><i class='fas fa-check-circle text-primary mt-0.5 mr-2 text-xs'></i><span>学生用户最多可同时借阅5本图书，教职工用户最多可同时借阅8本图书</span></li>
                <li class='flex items-start'><i class='fas fa-check-circle text-primary mt-0.5 mr-2 text-xs'></i><span>借阅期限为30天，可续借一次，续期15天</span></li>
                <li class='flex items-start'><i class='fas fa-check-circle text-primary mt-0.5 mr-2 text-xs'></i><span>逾期未还将收取0.5元/天/本的罚款</span></li>
                <li class='flex items-start'><i class='fas fa-check-circle text-primary mt-0.5 mr-2 text-xs'></i><span>图书归还时请确保完好无损，如有损坏将按原价赔偿</span></li>
            </ul>
        </div>

        <!-- 图书列表 -->
        <div class='mb-8'>
            <div class='flex justify-between items-center mb-4'>
                <h2 class='text-base font-medium text-dark'>可借阅图书</h2>
                <span id='bookCount' class='text-sm text-gray-500'>共 0 本</span>
            </div>
            
            <!-- 结果统计 -->
            <div id='resultInfo' class='text-xs text-gray-500 mb-3 hidden'>
                显示筛选结果 <span id='resultStart'>1</span>-<span id='resultEnd'>8</span> 项，共 <span id='resultTotal'>8</span> 项
            </div>
            
            <div id='bookList' class='space-y-4'>
                <!-- 加载状态 -->
                <div class='skeleton-loading h-28 rounded-xl mb-4'></div>
                <div class='skeleton-loading h-28 rounded-xl mb-4'></div>
                <div class='skeleton-loading h-28 rounded-xl mb-4'></div>
            </div>
            
            <!-- 空状态 -->
            <div id='emptyState' class='hidden text-center py-14'>
                <div class='w-24 h-24 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center'>
                    <i class='fas fa-book-open text-gray-300 text-4xl'></i>
                </div>
                <h3 class='text-base font-medium text-gray-700 mb-2'>未找到图书</h3>
                <p class='text-sm text-gray-500 mb-6'>没有找到符合当前筛选条件的图书</p>
                <button id='clearFiltersBtn' class='px-6 py-2 bg-primary text-white rounded-full text-sm font-medium transition-all duration-300 hover:bg-secondary'>
                    清除筛选条件
                </button>
            </div>
        </div>
    </main>

    <!-- 底部导航栏 -->
    <div class='fixed bottom-0 left-0 right-0 h-16 bg-white border-t border-gray-200 z-50 flex items-center justify-around'>
        <a href='books.html' class='nav-item flex flex-col items-center justify-center text-gray-500' data-target='books'>
            <i class='fas fa-book text-lg'></i>
            <span class='text-xs mt-1'>图书</span>
        </a>
        <a href='borrow.html' class='nav-item flex flex-col items-center justify-center text-primary' data-target='borrow'>
            <i class='fas fa-book-open text-lg'></i>
            <span class='text-xs mt-1'>借阅</span>
        </a>
        <a href='return.html' class='nav-item flex flex-col items-center justify-center text-gray-500' data-target='return'>
            <i class='fas fa-undo text-lg'></i>
            <span class='text-xs mt-1'>归还</span>
        </a>
        <a href='my-borrows.html' class='nav-item flex flex-col items-center justify-center text-gray-500' data-target='my'>
            <i class='fas fa-user text-lg'></i>
            <span class='text-xs mt-1'>我的</span>
        </a>
    </div>

    <!-- 引入存储管理模块 -->
    <script src='utils/storage.js'></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 模拟图书数据
            const mockBooks = [
                {
                    id: 1,
                    title: '活着',
                    author: '余华',
                    cover: 'https://picsum.photos/id/24/300/450',
                    rating: 9.4,
                    stock: 23,
                    category: 'literature',
                    publishDate: '2011-05',
                    isbn: '9787544243088'
                },
                {
                    id: 2,
                    title: '三体',
                    author: '刘慈欣',
                    cover: 'https://picsum.photos/id/20/300/450',
                    rating: 9.2,
                    stock: 18,
                    category: 'sci-fi',
                    publishDate: '2008-01',
                    isbn: '9787536692930'
                },
                {
                    id: 3,
                    title: '解忧杂货店',
                    author: '东野圭吾',
                    cover: 'https://picsum.photos/id/22/300/450',
                    rating: 8.9,
                    stock: 25,
                    category: 'literature',
                    publishDate: '2014-05',
                    isbn: '9787544270878'
                },
                {
                    id: 4,
                    title: '人类简史',
                    author: '尤瓦尔·赫拉利',
                    cover: 'https://picsum.photos/id/18/300/450',
                    rating: 9.1,
                    stock: 15,
                    category: 'history',
                    publishDate: '2014-11',
                    isbn: '9787508647357'
                },
                {
                    id: 5,
                    title: '爱因斯坦传',
                    author: '沃尔特·艾萨克森',
                    cover: 'https://picsum.photos/id/19/300/450',
                    rating: 8.8,
                    stock: 10,
                    category: 'biography',
                    publishDate: '2012-03',
                    isbn: '9787544257497'
                },
                {
                    id: 6,
                    title: '深度学习',
                    author: '伊恩·古德费洛',
                    cover: 'https://picsum.photos/id/17/300/450',
                    rating: 9.0,
                    stock: 8,
                    category: 'science',
                    publishDate: '2017-08',
                    isbn: '9787115461740'
                },
                {
                    id: 7,
                    title: '围城',
                    author: '钱钟书',
                    cover: 'https://picsum.photos/id/21/300/450',
                    rating: 9.3,
                    stock: 20,
                    category: 'literature',
                    publishDate: '1991-02',
                    isbn: '9787020002207'
                },
                {
                    id: 8,
                    title: '百年孤独',
                    author: '加西亚·马尔克斯',
                    cover: 'https://picsum.photos/id/23/300/450',
                    rating: 9.5,
                    stock: 12,
                    category: 'literature',
                    publishDate: '2011-06',
                    isbn: '9787544243019'
                }
            ];

            // 当前筛选条件
            let currentFilters = {
                search: '',
                category: 'all',
                sort: 'newest'
            };

            // 获取分类显示名称
            function getCategoryName(category) {
                const categoryMap = {
                    'literature': '文学艺术',
                    'science': '科学技术',
                    'history': '历史地理',
                    'biography': '人物传记',
                    'sci-fi': '科幻小说'
                };
                return categoryMap[category] || '其他';
            }

            // 过滤和排序图书
            function filterAndSortBooks(books) {
                let filtered = [...books];
                
                // 搜索过滤
                if (currentFilters.search) {
                    const searchLower = currentFilters.search.toLowerCase();
                    filtered = filtered.filter(book => 
                        book.title.toLowerCase().includes(searchLower) ||
                        book.author.toLowerCase().includes(searchLower) ||
                        book.isbn.includes(searchLower)
                    );
                }
                
                // 分类过滤
                if (currentFilters.category !== 'all') {
                    filtered = filtered.filter(book => book.category === currentFilters.category);
                }
                
                // 排序
                switch (currentFilters.sort) {
                    case 'rating':
                        filtered.sort((a, b) => b.rating - a.rating);
                        break;
                    case 'stock':
                        filtered.sort((a, b) => b.stock - a.stock);
                        break;
                    case 'newest':
                    default:
                        filtered.sort((a, b) => new Date(b.publishDate) - new Date(a.publishDate));
                        break;
                }
                
                return filtered;
            }

            // 渲染图书列表
            function renderBookList(books) {
                const bookListElement = document.getElementById('bookList');
                const emptyStateElement = document.getElementById('emptyState');
                const resultInfoElement = document.getElementById('resultInfo');
                
                // 更新图书计数
                document.getElementById('bookCount').textContent = `共 ${books.length} 本`;
                
                // 显示/隐藏结果信息
                if (books.length > 0) {
                    resultInfoElement.classList.remove('hidden');
                    document.getElementById('resultStart').textContent = books.length > 0 ? '1' : '0';
                    document.getElementById('resultEnd').textContent = Math.min(books.length, 100);
                    document.getElementById('resultTotal').textContent = books.length;
                } else {
                    resultInfoElement.classList.add('hidden');
                }
                
                // 清空并重新渲染列表
                bookListElement.innerHTML = '';
                
                if (books.length === 0) {
                    bookListElement.classList.add('hidden');
                    emptyStateElement.classList.remove('hidden');
                    return;
                }
                
                bookListElement.classList.remove('hidden');
                emptyStateElement.classList.add('hidden');
                
                books.forEach((book, index) => {
                    // 检查图书借阅状态
                    const isBorrowed = StorageManager && StorageManager.isBookBorrowedByUser ? 
                                      StorageManager.isBookBorrowedByUser(book.id) : false;
                    
                    const bookItem = document.createElement('div');
                    bookItem.className = 'book-item animate-slide-up';
                    bookItem.style.animationDelay = `${index * 50}ms`;
                    
                    bookItem.innerHTML = `
                        <div class='flex space-x-4'>
                            <div class='w-16 h-24 bg-gray-100 rounded-lg overflow-hidden shadow-sm flex-shrink-0 transform transition-transform duration-300 hover:scale-[1.02]'>
                                <img src='${book.cover}' alt='${book.title}' class='w-full h-full object-cover'>
                            </div>
                            <div class='flex-1 flex flex-col justify-between'>
                                <div>
                                    <h3 class='text-base font-medium mb-1 line-clamp-1'>${book.title}</h3>
                                    <p class='text-gray-600 text-sm mb-1'>${book.author}</p>
                                    <div class='flex items-center mb-1'>
                                        <div class='flex items-center mr-4'>
                                            <i class='fas fa-star text-yellow-400 text-xs mr-1'></i>
                                            <span class='text-primary text-sm'>${book.rating}</span>
                                        </div>
                                        <div class='flex items-center'>
                                            <i class='fas fa-box text-gray-400 text-xs mr-1'></i>
                                            <span class='text-gray-500 text-xs'>库存 ${book.stock}</span>
                                        </div>
                                    </div>
                                    <div class='flex items-center'>
                                        <span class='px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded-full'>
                                            ${getCategoryName(book.category)}
                                        </span>
                                    </div>
                                </div>
                                <div class='flex space-x-2 mt-2'>
                                    <button class='details-btn flex-1 py-1.5 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium text-center transition-all duration-300 hover:bg-gray-200' data-id='${book.id}'>
                                        查看详情
                                    </button>
                                    <button class='borrow-btn py-1.5 ${isBorrowed ? 'bg-gray-400' : 'bg-primary'} text-white rounded-lg text-sm font-medium text-center transition-all duration-300 hover:${isBorrowed ? 'bg-gray-500' : 'bg-secondary'} btn-hover' data-id='${book.id}' ${isBorrowed ? 'disabled' : ''}>
                                        ${isBorrowed ? '已借阅' : '借阅'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    bookListElement.appendChild(bookItem);
                });
                
                // 添加事件监听器
                attachEventListeners();
            }

            // 添加事件监听器
            function attachEventListeners() {
                // 查看详情按钮
                document.querySelectorAll('.details-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const bookId = this.getAttribute('data-id');
                        // 添加点击动画
                        this.classList.add('scale-95');
                        setTimeout(() => {
                            this.classList.remove('scale-95');
                            window.location.href = `book-detail.html?id=${bookId}`;
                        }, 100);
                    });
                });
                
                // 借阅按钮
                document.querySelectorAll('.borrow-btn:not(:disabled)').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const bookId = parseInt(this.getAttribute('data-id'));
                        // 添加点击动画
                        this.classList.add('scale-95');
                        setTimeout(() => {
                            this.classList.remove('scale-95');
                            handleBorrowBook(bookId);
                        }, 100);
                    });
                });
            }

            // 处理图书借阅
            function handleBorrowBook(bookId) {
                // 检查StorageManager是否存在以及用户是否登录
                if (!StorageManager || !StorageManager.isLoggedIn()) {
                    showToast('请先登录', 'error');
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 1500);
                    return;
                }

                // 检查用户借阅数量限制
                const borrowedBooks = StorageManager.getCurrentBorrowedBooks();
                const currentUser = StorageManager.getUserInfo();
                const maxBorrowLimit = currentUser && currentUser.userType === 'staff' ? 8 : 5;
                
                if (borrowedBooks.length >= maxBorrowLimit) {
                    showToast(`已达到借阅上限(${maxBorrowLimit}本)`, 'error');
                    return;
                }

                // 检查图书是否已被当前用户借阅
                if (StorageManager.isBookBorrowedByUser(bookId)) {
                    showToast('您已借阅过这本书', 'info');
                    return;
                }

                // 获取图书信息
                const book = mockBooks.find(b => b.id === bookId);
                if (!book) {
                    showToast('图书信息不存在', 'error');
                    return;
                }

                // 显示借阅确认对话框
                if (confirm(`确定要借阅《${book.title}》吗？`)) {
                    // 添加借阅记录
                    if (StorageManager.addBorrowRecord({
                        id: book.id,
                        title: book.title,
                        author: book.author,
                        cover: book.cover
                    })) {
                        showToast('借阅成功！');
                        // 更新按钮状态
                        const borrowBtn = document.querySelector(`.borrow-btn[data-id='${bookId}']`);
                        if (borrowBtn) {
                            borrowBtn.textContent = '已借阅';
                            borrowBtn.classList.remove('bg-primary', 'hover:bg-secondary');
                            borrowBtn.classList.add('bg-gray-400', 'hover:bg-gray-500');
                            borrowBtn.disabled = true;
                        }
                    } else {
                        showToast('借阅失败，请稍后重试', 'error');
                    }
                }
            }

            // 初始化筛选按钮
            function initFilterButtons() {
                // 分类筛选按钮
                document.querySelectorAll('.category-filter').forEach(btn => {
                    btn.addEventListener('click', function() {
                        document.querySelectorAll('.category-filter').forEach(b => {
                            b.classList.remove('filter-btn-active');
                            b.classList.add('filter-btn-inactive');
                        });
                        this.classList.remove('filter-btn-inactive');
                        this.classList.add('filter-btn-active');
                        currentFilters.category = this.getAttribute('data-category');
                        updateBookList();
                    });
                });
                
                // 排序筛选按钮
                document.querySelectorAll('.sort-filter').forEach(btn => {
                    btn.addEventListener('click', function() {
                        document.querySelectorAll('.sort-filter').forEach(b => {
                            b.classList.remove('filter-btn-active');
                            b.classList.add('filter-btn-inactive');
                        });
                        this.classList.remove('filter-btn-inactive');
                        this.classList.add('filter-btn-active');
                        currentFilters.sort = this.getAttribute('data-sort');
                        updateBookList();
                    });
                });
                
                // 重置筛选按钮
                document.getElementById('resetFilterBtn').addEventListener('click', function() {
                    resetFilters();
                });
                
                // 清除筛选条件按钮（空状态时）
                document.getElementById('clearFiltersBtn').addEventListener('click', function() {
                    resetFilters();
                });
            }

            // 重置筛选条件
            function resetFilters() {
                currentFilters = {
                    search: '',
                    category: 'all',
                    sort: 'newest'
                };
                document.getElementById('searchInput').value = '';
                
                // 重置分类按钮
                document.querySelectorAll('.category-filter').forEach(b => {
                    b.classList.remove('filter-btn-active');
                    b.classList.add('filter-btn-inactive');
                });
                document.querySelector('.category-filter[data-category="all"]').classList.remove('filter-btn-inactive');
                document.querySelector('.category-filter[data-category="all"]').classList.add('filter-btn-active');
                
                // 重置排序按钮
                document.querySelectorAll('.sort-filter').forEach(b => {
                    b.classList.remove('filter-btn-active');
                    b.classList.add('filter-btn-inactive');
                });
                document.querySelector('.sort-filter[data-sort="newest"]').classList.remove('filter-btn-inactive');
                document.querySelector('.sort-filter[data-sort="newest"]').classList.add('filter-btn-active');
                
                updateBookList();
            }

            // 初始化搜索功能
            function initSearch() {
                const searchInput = document.getElementById('searchInput');
                let searchTimeout;
                
                searchInput.addEventListener('input', function() {
                    // 清除之前的定时器
                    clearTimeout(searchTimeout);
                    
                    // 设置新的定时器，实现搜索防抖
                    searchTimeout = setTimeout(() => {
                        currentFilters.search = this.value.trim();
                        updateBookList();
                    }, 300);
                });
                
                // 添加搜索图标点击事件
                const searchIcon = searchInput.nextElementSibling;
                searchIcon.addEventListener('click', function() {
                    currentFilters.search = searchInput.value.trim();
                    updateBookList();
                });
                
                // 添加回车键搜索
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        currentFilters.search = this.value.trim();
                        updateBookList();
                    }
                });
            }

            // 更新图书列表
            function updateBookList() {
                // 显示加载状态
                const bookListElement = document.getElementById('bookList');
                bookListElement.innerHTML = `
                    <div class='skeleton-loading h-28 rounded-xl mb-4'></div>
                    <div class='skeleton-loading h-28 rounded-xl mb-4'></div>
                    <div class='skeleton-loading h-28 rounded-xl mb-4'></div>
                `;
                bookListElement.classList.remove('hidden');
                document.getElementById('emptyState').classList.add('hidden');
                
                // 模拟加载延迟
                setTimeout(() => {
                    const filteredBooks = filterAndSortBooks(mockBooks);
                    renderBookList(filteredBooks);
                }, 400);
            }

            // Toast提示函数 - 优化版
            function showToast(message, type = 'success') {
                // 移除之前的toast
                const existingToast = document.querySelector('.toast-notification');
                if (existingToast) {
                    existingToast.remove();
                }
                
                const toast = document.createElement('div');
                const icon = type === 'error' ? 'fa-exclamation-circle' : 
                            type === 'info' ? 'fa-info-circle' : 'fa-check-circle';
                const bgColor = type === 'error' ? 'bg-red-500' : 
                               type === 'info' ? 'bg-blue-500' : 'bg-primary';
                
                toast.className = `toast-notification fixed top-20 left-1/2 transform -translate-x-1/2 px-4 py-3 rounded-lg text-white ${bgColor} shadow-lg z-50 flex items-center animate-fade-in`;
                toast.innerHTML = `
                    <i class='fas ${icon} mr-2'></i>
                    <span>${message}</span>
                `;
                
                document.body.appendChild(toast);
                
                // 添加点击关闭功能
                toast.addEventListener('click', function() {
                    this.style.opacity = '0';
                    setTimeout(() => {
                        this.remove();
                    }, 300);
                });
                
                // 自动消失
                setTimeout(() => {
                    toast.style.opacity = '0';
                    setTimeout(() => {
                        if (document.body.contains(toast)) {
                            document.body.removeChild(toast);
                        }
                    }, 300);
                }, 3000);
            }

            // 返回按钮事件
            document.getElementById('backBtn').addEventListener('click', function() {
                // 添加点击动画
                this.classList.add('scale-90');
                setTimeout(() => {
                    this.classList.remove('scale-90');
                    window.history.back();
                }, 100);
            });
            
            // 导航栏点击事件
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    const href = this.getAttribute('href');
                    if (href && !this.classList.contains('text-primary')) {
                        // 添加点击动画
                        this.classList.add('scale-95');
                        setTimeout(() => {
                            this.classList.remove('scale-95');
                            window.location.href = href;
                        }, 100);
                    }
                });
            });

            // 初始化
            function init() {
                initFilterButtons();
                initSearch();
                // 延迟加载，模拟网络请求
                setTimeout(() => {
                    updateBookList();
                }, 600);
            }

            init();
        });
    </script>
</body>
</html>